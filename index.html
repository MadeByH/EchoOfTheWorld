<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, orientation=landscape" />
<title>Topâ€‘Down 3D World Game</title>
<style>
html,body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: radial-gradient(circle at center, #87cefa 40%, #5bc0de 100%);
}

/* ØªØ§Ú©ÛŒØ¯ Ø¨Ø± Ø­Ø§Ù„Øª Ø§ÙÙ‚ÛŒ (Landscape) */
@media screen and (orientation: portrait) {
  body::before {
    content: "ğŸ”„ Ù„Ø·ÙØ§ Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø§ÙÙ‚ÛŒ Ø¨Ú†Ø±Ø®Ø§Ù†!";
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: #fff;
    font-size: 22px;
    font-family: sans-serif;
    z-index: 999;
  }
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
  perspective: 1000px;
  overflow: hidden;
}

#world {
  position: absolute;
  width: 4000px;
  height: 4000px;
  background: repeating-linear-gradient(45deg, #4caf50 0 80px, #43a047 80px 160px);
  transform-origin: center;
  transform: rotateX(60deg) translateZ(-500px);
}

/* Ø²Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ ØªØ²Ø¦ÛŒÙ†ÛŒ */
.tile {
  position: absolute;
  width: 200px;
  height: 200px;
  background: rgba(0,0,0,0.05);
  border: 1px solid rgba(255,255,255,0.2);
}

/* Ú©Ø§Ø±Ø§Ú©ØªØ± Ø§Ø² Ø¨Ø§Ù„Ø§ Ø¯ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
#player {
  position: absolute;
  width: 60px;
  height: 60px;
  background: url('https://cdn-icons-png.flaticon.com/512/4140/4140048.png') center/contain no-repeat;
  transform: translateZ(30px);
  transition: transform 0.05s linear;
}

/* Ø¬ÙˆÛŒâ€ŒØ§Ø³ØªÛŒÚ© */
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.3);
  touch-action: none;
  z-index: 10;
}
#stick {
  position: absolute;
  top: 45px;
  left: 45px;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: rgba(255,255,255,0.9);
  pointer-events: none;
}
</style>
</head>

<body>
<div id="game">
  <div id="world">
    <div id="player"></div>
  </div>
</div>

<div id="joystick">
  <div id="stick"></div>
</div>

<script>
const player = document.getElementById('player');
const world = document.getElementById('world');
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');

let joyActive = false;
let center = {x: 0, y: 0};
let delta = {x: 0, y: 0};
let joyRadius = 40;
let velocity = {x: 0, y: 0};
let speed = 5;

// Ù…Ø®ØªØµØ§Øª Ø¨Ø§Ø²ÛŒÚ©Ù† ÙˆØ³Ø· Ø¬Ù‡Ø§Ù†
let playerPos = {x: 2000, y: 2000};

// ğŸŒ Ù…Ù†Ø·Ù‚ Ø¬ÙˆÛŒâ€ŒØ§Ø³ØªÛŒÚ©
joystick.addEventListener('touchstart', (e) => {
  joyActive = true;
  const rect = joystick.getBoundingClientRect();
  center.x = rect.left + rect.width / 2;
  center.y = rect.top + rect.height / 2;
});

joystick.addEventListener('touchmove', (e) => {
  if (!joyActive) return;
  let t = e.touches[0];
  delta.x = t.clientX - center.x;
  delta.y = t.clientY - center.y;
  const dist = Math.sqrt(delta.x**2 + delta.y**2);
  const angle = Math.atan2(delta.y, delta.x);
  if (dist > joyRadius) {
    delta.x = Math.cos(angle) * joyRadius;
    delta.y = Math.sin(angle) * joyRadius;
  }
  stick.style.transform = `translate(${delta.x}px, ${delta.y}px)`;
  // Ø³Ø±Ø¹Øª Ø¨Ø±Ø§Ø³Ø§Ø³ Ù…Ø­ÙˆØ± X Ùˆ Y (topâ€‘down)
  velocity.x = (delta.x / joyRadius) * speed;
  velocity.y = (delta.y / joyRadius) * speed;
});

joystick.addEventListener('touchend', () => {
  joyActive = false;
  stick.style.transform = `translate(0px, 0px)`;
  velocity = {x: 0, y: 0};
});

// ğŸï¸ Ø­Ù„Ù‚Ù‡ Ø­Ø±Ú©ØªÛŒ ÙØ±ÛŒÙ… Ø¨Ù‡ ÙØ±ÛŒÙ…
function loop() {
  playerPos.x += velocity.x;
  playerPos.y += velocity.y;

  // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ø± Ù…Ø±Ø² Ø¯Ù†ÛŒØ§:
  playerPos.x = Math.max(0, Math.min(3940, playerPos.x));
  playerPos.y = Math.max(0, Math.min(3940, playerPos.y));

  // Ø­Ø±Ú©Øª Ø¯Ù†ÛŒØ§ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù† (Ø¯ÙˆØ±Ø¨ÛŒÙ†)
  world.style.transform = `
      rotateX(60deg)
      translateZ(-500px)
      translateX(${-playerPos.x + window.innerWidth/2}px)
      translateY(${-playerPos.y + window.innerHeight/1.5}px)
  `;

  // ØªØºÛŒÛŒØ± Ø²Ø§ÙˆÛŒÙ‡ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ù‡Øª Ø­Ø±Ú©Øª
  if (velocity.x !== 0 || velocity.y !== 0) {
    let angleDeg = Math.atan2(-velocity.y, velocity.x) * 180 / Math.PI;
    player.style.transform = `translateZ(30px) rotateZ(${angleDeg}deg)`;
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
