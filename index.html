<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Echo Of The World</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body { margin: 0; overflow: hidden; touch-action: none; }
    canvas { display: block; }
  </style>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#87CEEB', // آسمان آبی
    physics: {
        default: 'arcade',
        arcade: { debug: false }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    },
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
    }
};

const game = new Phaser.Game(config);

let player;
let joystick = { x:0, y:0, active:false, pointerId:null };

function preload() {
    this.load.image('player', 'https://labs.phaser.io/assets/sprites/phaser-dude.png');
}

function create() {
    this.physics.world.setBounds(0, 0, 2000, 2000);

    // زمین سبز بزرگ
    const graphics = this.add.graphics();
    graphics.fillStyle(0x228B22, 1);
    graphics.fillRect(0, 0, 2000, 2000);

    // بازیکن
    player = this.physics.add.sprite(400, 300, 'player');
    player.setCollideWorldBounds(true);

    // دوربین دنبال‌کننده
    this.cameras.main.setBounds(0, 0, 2000, 2000);
    this.cameras.main.startFollow(player);

    // لمس جوی‌استیک
    this.input.on('pointerdown', (pointer) => {
        if(pointer.x < window.innerWidth/2) {
            joystick.active = true;
            joystick.x = pointer.x;
            joystick.y = pointer.y;
            joystick.pointerId = pointer.id;
        }
    });

    this.input.on('pointerup', (pointer) => {
        if(pointer.id === joystick.pointerId) {
            joystick.active = false;
            joystick.pointerId = null;
        }
    });

    this.input.on('pointermove', (pointer) => {
        if(joystick.active && pointer.id === joystick.pointerId) {
            joystick.dx = pointer.x - joystick.x;
            joystick.dy = pointer.y - joystick.y;
        }
    });
}

function update() {
    const speed = 250;
    let vx = 0, vy = 0;

    if(joystick.active) {
        vx = joystick.dx;
        vy = joystick.dy;
        const maxDist = 50; // شعاع جوی‌استیک
        const mag = Math.sqrt(vx*vx + vy*vy);
        if(mag > maxDist) {
            vx = (vx/mag)*maxDist;
            vy = (vy/mag)*maxDist;
        }
        player.setVelocity(vx*5, vy*5); // سرعت حرکت
    } else {
        player.setVelocity(0);
    }

    // جوی‌استیک را رسم می‌کنیم
    if(this.joystickGraphics) this.joystickGraphics.clear();
    this.joystickGraphics = this.add.graphics();
    if(joystick.active) {
        this.joystickGraphics.fillStyle(0x888888, 0.5);
        this.joystickGraphics.fillCircle(joystick.x, joystick.y, 50);
        this.joystickGraphics.fillStyle(0xcccccc, 0.8);
        this.joystickGraphics.fillCircle(joystick.x + vx, joystick.y + vy, 25);
    }
}
</script>

</body>
</html>
